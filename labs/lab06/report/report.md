---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Адресация IPv4 и IPv6. Двойной стек"
author: "Гафоров Нурмухаммад"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Введение

## Цель работы  

Изучение принципов распределения и настройки адресного пространства на устройствах сети.

# Ход выполнения

## Разбиение IPv4-сетей на подсети

### Сеть 172.16.20.0/24

**База сети**
- Префикс: **/24**
- Маска: **255.255.255.0**
- Кол-во адресов в сети: **256**
- Кол-во адресов хостов: **254**
- Broadcast: **172.16.20.255**
- Диапазон хостов: **172.16.20.1 – 172.16.20.254**

**Замечание про “число возможных подсетей”**  
Внутри /24 можно дробить на подсети произвольного размера (VLSM). Например:
- /25 → 2 подсети,
- /26 → 4 подсети,
- /27 → 8 подсетей,
и т. д. (каждый «заём» одного бита удваивает число подсетей).

**Требуемое разбиение: 126, 62, 62 адресов хостов (VLSM)**  
- Подсеть A: **/25** (128 адресов, 126 хостов)  
  - Сеть: **172.16.20.0/25**  
  - Хосты: **172.16.20.1 – 172.16.20.126**  
  - Broadcast: **172.16.20.127**
- Подсеть B: **/26** (64 адреса, 62 хоста)  
  - Сеть: **172.16.20.128/26**  
  - Хосты: **172.16.20.129 – 172.16.20.190**  
  - Broadcast: **172.16.20.191**
- Подсеть C: **/26** (64 адреса, 62 хоста)  
  - Сеть: **172.16.20.192/26**  
  - Хосты: **172.16.20.193 – 172.16.20.254**  
  - Broadcast: **172.16.20.255**

### Сеть 10.10.1.64/26

**База сети**
- Префикс: **/26**
- Маска: **255.255.255.192**
- Кол-во адресов в сети: **64**
- Кол-во адресов хостов: **62**
- Сеть: **10.10.1.64**
- Broadcast: **10.10.1.127**
- Диапазон хостов: **10.10.1.65 – 10.10.1.126**

**Подсеть на 30 узлов** (нужно ≥30 хостов → /27, т.е. 32 адреса, 30 хостов):
- Выделяем **10.10.1.64/27**
  - Хосты: **10.10.1.65 – 10.10.1.94**
  - Broadcast: **10.10.1.95**

### Сеть 10.10.1.0/26

**База сети**
- Префикс: **/26**
- Маска: **255.255.255.192**
- Кол-во адресов в сети: **64**
- Кол-во адресов хостов: **62**
- Сеть: **10.10.1.0**
- Broadcast: **10.10.1.63**
- Диапазон хостов: **10.10.1.1 – 10.10.1.62**

**Подсеть на 14 узлов** (нужно ≥14 хостов → /28, т.е. 16 адресов, 14 хостов):
- Выделяем **10.10.1.0/28**
  - Хосты: **10.10.1.1 – 10.10.1.14**
  - Broadcast: **10.10.1.15**

## Разбиение IPv6-сети на подсети

### Сеть **2001:db8:c0de::/48**

**Характеристика адреса**
- Префикс: **/48**  
- Маска (hex): **ffff:ffff:ffff::**  
- Фиксированная часть: **2001:db8:c0de**  
- Диапазон адресов всей /48:  
  **2001:db8:c0de:0000:0000:0000:0000:0000** – **2001:db8:c0de:ffff:ffff:ffff:ffff:ffff**  
- Внутри /48 стандартно выделяют /64-подсети: 16 бит **Subnet ID** (четвёртый хекстет), 64 бита **Interface ID**.  
  В IPv6 нет broadcast; используются multicast и ICMPv6 (ND).

 Вариант A — *с использованием идентификатора подсети*  

(увеличиваем длину префикса, делим /48 на две равные крупные подсети /49)

- **Подсеть 1:** `2001:db8:c0de:0000::/49`  
  Содержит Subnet ID от `0000` до `7fff` (т.е. 2¹⁵ разных /64).
- **Подсеть 2:** `2001:db8:c0de:8000::/49`  
  Содержит Subnet ID от `8000` до `ffff` (ещё 2¹⁵ /64).

Вариант B — *с использованием идентификатора интерфейса*  

(делим одну /64 на две части, «занимая» 1 бит из **Interface ID** → /65)

Например, возьмём одну /64: `2001:db8:c0de:0000::/64` и разделим её:

- **Часть 1 (IID старший бит = 0):** `2001:db8:c0de:0000:0000:0000:0000:0000/65`  
  Диапазон IID: `0000:...:0000` – `7fff:ffff:ffff:ffff`.
- **Часть 2 (IID старший бит = 1):** `2001:db8:c0de:0000:8000:0000:0000:0000/65`  
  Диапазон IID: `8000:...:0000` – `ffff:ffff:ffff:ffff`.

### Сеть **2a02:6b8::/64**

**Характеристика адреса**
- Префикс: **/64**  
- Маска (hex): **ffff:ffff:ffff:ffff::**  
- Фиксированная часть: **2a02:06b8:0000:0000**  
- Диапазон адресов всей /64:  
  **2a02:6b8:0:0:0000:0000:0000:0000** – **2a02:6b8:0:0:ffff:ffff:ffff:ffff**

Вариант A — *с использованием идентификатора подсети (административно расширяем префикс)*

Разделим исходную /64 на две /65:

- **Подсеть 1:** `2a02:6b8::/65`  
  (IID старший бит = 0; адреса `…:0000:0000:0000:0000` – `…:7fff:ffff:ffff:ffff`)
- **Подсеть 2:** `2a02:6b8:0:0:8000::/65`  
  (IID старший бит = 1; адреса `…:8000:0000:0000:0000` – `…:ffff:ffff:ffff:ffff`)

Вариант B — *с использованием идентификатора интерфейса (логическое разделение IID без смены префикса)*

Оставляем префикс **/64** неизменным, но резервируем два непересекающихся диапазона **IID**:

- **Группа 1 (IID 0…7fff:ffff:ffff:ffff):** адреса `2a02:6b8::1` … `2a02:6b8::7fff:ffff:ffff:ffff`
- **Группа 2 (IID 8000:…:ffff:ffff):** адреса `2a02:6b8::8000:0:0:0` … `2a02:6b8::ffff:ffff:ffff:ffff`

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

В среде **GNS3** создан новый проект и размещены устройства согласно предоставленной топологии. В рабочем пространстве расположены два узла VPCS, коммутаторы, маршрутизатор **FRR** и сервер с двойным стеком адресации (IPv4/IPv6).

![Топология сети GNS3](Screenshot_1.png){ #fig:001 width=80% }

### PC1

Назначен IPv4-адрес и шлюз по умолчанию:

ip 172.16.20.10/25 172.16.20.1  
save

После этого отображена конфигурация IPv4 и IPv6 (`show ip`, `show ipv6`).

![Конфигурация PC1](Screenshot_2.png){ #fig:002 width=70% }

### PC2

Назначение параметров IPv4 и шлюза по умолчанию:

ip 172.16.20.138/25 172.16.20.129  
save

Выведены сведения о назначенных IPv4 и IPv6-адресах.

![Конфигурация PC2](Screenshot_3.png){ #fig:003 width=70% }

### Настройка IPv4 на сервере с двойным стеком

Назначен IP-адрес и шлюз для сервера:

ip 64.100.1.10/24 64.100.1.1  
save

![Сервер Dual Stack](Screenshot_4.png){ #fig:004 width=70% }

### Настройка маршрутизатора FRR (msk-ngaforov-gw-01)

На маршрутизаторе **FRR** настроены интерфейсы локальных сетей:

| Интерфейс | Назначение сегмента | IPv4-адрес |
|----------|----------------------|------------|
| eth0     | Подсеть PC1          | 172.16.20.1/25 |
| eth1     | Подсеть PC2          | 172.16.20.129/25 |
| eth2     | Подсеть сервера      | 64.100.1.1/24 |

![Назначение адресов на FRR](Screenshot_5.png){ #fig:005 width=70% }

Просмотр текущей конфигурации маршрутизатора:

![show running-config](Screenshot_6.png){ #fig:006 width=70% }

Просмотр состояния интерфейсов:

![show interface brief](Screenshot_7.png){ #fig:007 width=70% }

### Проверка связности между узлами

Проверка с PC1

Выполнены ICMP-эхо-запросы к PC2 и серверу, ответы получены успешно. Трассировка показывает прохождение через маршрутизатор FRR.

![ping+trace с PC1](Screenshot_8.png){ #fig:008 width=75% }

Проверка с PC2

PC2 успешно отправляет ICMP-эхо-запросы к PC1 и серверу. Ответы получены.

![ping+trace с PC2](Screenshot_9.png){ #fig:009 width=75% }

### Настройка IPv6 на PC3, PC4 и сервере Dual Stack

В соответствии с таблицей задания выполнена настройка IPv6-адресов на узлах PC3, PC4 и сервере с двойным стеком.

На узле PC3 назначен IPv6-адрес с префиксом /64:

ip 2001:db8:c0de:12::a/64  
save

После настройки просмотрена конфигурация IPv4/IPv6 (`show ip`, `show ipv6`). IPv4 отсутствует, IPv6 назначен корректно.

![Конфигурация PC3 IPv6](Screenshot_10.png){ #fig:010 width=70% }

На PC4 назначен IPv6-адрес из другой подсети:

ip 2001:db8:c0de:13::a/64  
save

Просмотр конфигурации подтверждает корректность назначения.

![Конфигурация PC4 IPv6](Screenshot_11.png){ #fig:011 width=70% }

Сервер уже содержал IPv4-адрес, дополнительно назначен IPv6:

ip 2001:db8:c0de:11::a/64  
save

![Конфигурация сервера IPv6](Screenshot_12.png){ #fig:012 width=70% }

### Настройка IPv6 на маршрутизаторе VyOS (msk-ngaforov-gw-02)

Маршрутизатору VyOS назначены адреса IPv6 для всех интерфейсов, а также включено распространение RA (Router Advertisement), чтобы узлы могли получать параметры автоматически.

Назначенные адреса:

| Интерфейс | Назначение сегмента | IPv6-адрес |
|----------|----------------------|------------|
| eth0     | подсеть PC3          | 2001:db8:c0de:12::1/64 |
| eth1     | подсеть PC4          | 2001:db8:c0de:13::1/64 |
| eth2     | подсеть Dual Stack Server | 2001:db8:c0de:11::1/64 |

![Настройка адресов на VyOS](Screenshot_13.png){ #fig:013 width=75% }

После применения конфигурации выполнены команды commit и save, затем проверены интерфейсы:

![Состояние интерфейсов VyOS](Screenshot_14.png){ #fig:014 width=70% }

### Проверка связности по IPv6

На PC3 выполнен ping и trace до IPv6-адресов PC4 и сервера. Ответы получены успешно — маршрутизация через VyOS работает.

![PC3: проверка IPv6](Screenshot_15.png){ #fig:015 width=75% }

На PC4 выполнены аналогичные проверки — также получены успешные ответы.

![PC4: проверка IPv6](Screenshot_16.png){ #fig:016 width=75% }

На сервере проверено взаимодействие с обеими IPv6-подсетями, ответы получены.

![Dual Stack Server: проверки IPv6](Screenshot_17.png){ #fig:017 width=75% }

### Анализ захваченного трафика ARP, ICMP и ICMPv6

На соединении между сервером с двойным стеком адресации и коммутатором был выполнен захват трафика в **Wireshark**. На основании перехваченных пакетов проанализированы три протокола: ARP (для IPv4), ICMP (для IPv4) и ICMPv6 (для IPv6).

ARP используется только в IPv4-сетях и работает на канальном уровне.  
Во время ping-запроса сервер должен определить MAC-адрес шлюза для отправки пакета.

На перехваченном кадре видно:

- Отправитель спрашивает: *«Who has 64.100.1.10? Tell 64.100.1.1»*.
- В пакете содержатся:
  - MAC-адрес отправителя (сервер)
  - IPv4-адрес отправителя (`64.100.1.1`)
  - Запрашиваемый IPv4-адрес (`64.100.1.10`)
  - MAC-адрес назначения — `00:00:00:00:00:00` (ещё неизвестен)

![ARP-запрос](Screenshot_18.png){ #fig:018 width=80% }

**Из ARP-пакета можно извлечь:**

- физический (MAC) адрес отправителя,
- IP-адрес отправителя и IP-адрес искомого узла,
- факт, что это ARP Request (opcode: request),
- тип протокола (IPv4) и тип канального уровня (Ethernet).

ICMP используется для диагностики и проверки связности сети.  
После ARP-разрешения адресов происходит обмен ICMP Echo Request / Echo Reply.

В перехваченном ICMP-кадре видно:

- отправитель: `172.16.20.129`
- получатель: `64.100.1.10`
- тип ICMP: Echo Request
- параметры: ttl=64, checksum корректна
- также видно время отклика (Response time)

![ICMP Echo (IPv4)](Screenshot_19.png){ #fig:019 width=80% }

**Из ICMP-пакета можно извлечь:**

- исходный и целевой IPv4-адрес,
- TTL (время жизни) — сколько маршрутизаторов может пройти пакет,
- информацию о типе ICMP (запрос или ответ),
- задержку (время отклика).

ICMPv6 протокол выполняет в IPv6 ту же роль, что ICMP в IPv4 — диагностика и контроль.  
При обмене echo-запросами между хостами была перехвачена ICMPv6 Echo Reply.

В пакете видно:

- IPv6-адрес источника: `2001:db8:c0de:13::a`
- IPv6-адрес назначения: `2001:db8:c0de:11::a`
- тип сообщения: Echo (ping) reply
- hop-limit (аналог TTL)

![ICMPv6 Echo (IPv6)](Screenshot_20.png){ #fig:020 width=80% }

**Из ICMPv6-пакета можно извлечь:**

- исходный и целевой IPv6-адрес,
- hop limit (аналог TTL в IPv6),
- тип ICMPv6-сообщения (Echo Request или Echo Reply),
- время отклика.

## Самостоятельное задание: настройка двух подсетей IPv4/IPv6 и проверка связности

![Топология](Screenshot_21.png){ #fig:021 width=75% }

### Подсеть 1 (IPv4)
- Сеть: **10.10.1.96/27** (маска 255.255.255.224)
- Диапазон хостов: **10.10.1.97 – 10.10.1.126**
- Широковещательный адрес: **10.10.1.127**
- Кол-во адресов для хостов: **30**

### Подсеть 2 (IPv4)
- Сеть: **10.10.1.16/28** (маска 255.255.255.240)
- Диапазон хостов: **10.10.1.17 – 10.10.1.30**
- Широковещательный адрес: **10.10.1.31**
- Кол-во адресов для хостов: **14**

### Подсети IPv6
- Подсеть 1: **2001:db8:1:1::/64**
  - Маршрутизатор: **2001:db8:1:1::1**
  - Пример хоста (PC1): **2001:db8:1:1::a**
  - В IPv6 нет broadcast; используется **multicast** и **ICMPv6/ND**.
- Подсеть 2: **2001:db8:1:4::/64**
  - Маршрутизатор: **2001:db8:1:4::1**
  - Пример хоста (PC2): **2001:db8:1:4::a**

### Таблица адресации

| Устройство / Интерфейс | Подсеть | IPv4 | IPv6 |
|---|---|---|---|
| **VyOS msk-ngaforov-gw-01 — eth0** | Подсеть 1 | **10.10.1.97/27** | **2001:db8:1:1::1/64** |
| **VyOS msk-ngaforov-gw-01 — eth1** | Подсеть 2 | **10.10.1.17/28** | **2001:db8:1:4::1/64** |
| **PC1** | Подсеть 1 | **10.10.1.100/27**, GW **10.10.1.97** | **2001:db8:1:1::a/64** |
| **PC2** | Подсеть 2 | **10.10.1.20/28**, GW **10.10.1.17** | **2001:db8:1:4::a/64** |
| **Коммутаторы** | L2 | — | — |

### Настройка устройств

![PC1: show ip/ipv6](Screenshot_22.png){ #fig:022 width=55% }

![PC2: show ip/ipv6](Screenshot_23.png){ #fig:023 width=55% }

Маршрутизатор VyOS 
- На **eth0**: `10.10.1.97/27`, `2001:db8:1:1::1/64`, включён RA для `2001:db8:1:1::/64`
- На **eth1**: `10.10.1.17/28`, `2001:db8:1:4::1/64`, включён RA для `2001:db8:1:4::/64`

![VyOS](Screenshot_24.png){ #fig:024 width=70% }

Проверка интерфейсов после `commit`/`save`:

![VyOS: show interfaces](Screenshot_25.png){ #fig:025 width=55% }


### Проверка связности (ping/trace)

С PC1:
- **IPv4:** успешный `ping` до **PC2 (10.10.1.20)**
- **IPv6:** успешный `ping` до **PC2 (2001:db8:1:4::a)**

![PC1: ping IPv4/IPv6](Screenshot_26.png){ #fig:026 width=55% }

# Вывод

В ходе работы был проанализирован процесс установления соединения по протоколу **TCP** с использованием анализатора трафика **Wireshark**. Исследование показало, что трёхэтапное рукопожатие (**Three-Way Handshake**) обеспечивает надёжное установление соединения между клиентом и сервером перед началом передачи данных. В результате анализа зафиксированы стадии обмена сегментами **SYN**, **SYN/ACK** и **ACK**, подтверждающие успешную синхронизацию номеров последовательности и готовность сторон к коммуникации. Полученные данные подтверждают корректную реализацию транспортного уровня в модели OSI и демонстрируют принцип работы TCP при передаче HTTP-запросов.  